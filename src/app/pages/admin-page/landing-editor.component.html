
<!-- Banner persistente de bienvenida -->
<div class="mb-4" *ngIf="showWelcomeBanner()">
    <div class="border-round p-4 shadow-2" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-left: 4px solid #F59E0B;">
        <div class="flex align-items-center justify-content-between flex-wrap gap-3">
            <div class="flex align-items-start gap-3 flex-1">
                <span class="text-4xl" style="line-height: 1;">üöÄ</span>
                <div>
                    <div class="font-semibold text-xl mb-2" style="color: #92400E;">{{ bannerMessage().title }}</div>
                    <div class="line-height-3" style="color: #78350F;">{{ bannerMessage().description }}</div>
                </div>
            </div>
            <p-button
                [label]="bannerMessage().buttonText"
                icon="pi pi-arrow-right"
                iconPos="right"
                severity="warn"
                (onClick)="navigateToWelcomeCampaign()"
                styleClass="white-space-nowrap">
            </p-button>
        </div>
    </div>
</div>

<div class="flex flex-col md:flex-row gap-8">
  <div class="w-full">
    <div class="card flex flex-col gap-6 bg-white rounded-xl shadow-md p-6">
      <div class="w-full overflow-x-auto">
  <p-stepper [value]="step" (valueChange)="onStepChange($event)" orientation="vertical" class="mb-4 min-w-[180px] md:min-w-0">
          <p-step-list>
            <p-step [value]="1">Datos Generales</p-step>
            <p-step [value]="2">Historia y Filosof√≠a</p-step>
            <p-step [value]="3">Informaci√≥n de Contacto</p-step>
            <p-step [value]="4">Redes Sociales</p-step>
            <p-step [value]="5">Vista Previa</p-step>
          </p-step-list>
        </p-stepper>
      </div>

      <form [formGroup]="landingForm" class="flex flex-col gap-6">
        <ng-container [ngSwitch]="step">
        <!-- Paso 1: Datos Generales -->
  <div *ngSwitchCase="1" class="flex flex-col gap-4">
          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="logo">Logo del negocio</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Sube el logo que representar√° visualmente tu negocio en la p√°gina."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo logo'"
              ></button>
            </div>
            <p-fileUpload
              mode="basic"
              name="logo"
              accept="image/*"
              maxFileSize="1000000"
              (onSelect)="onFileSelect($event)"
              chooseLabel="Seleccionar logo"
              chooseIcon="pi pi-upload"
              class="w-full logo-fileupload"
            ></p-fileUpload>
            <small class="text-500 block mt-2" *ngIf="landingForm.get('logo')?.value && landingForm.get('logo')?.value.name">Archivo: {{ landingForm.get('logo')?.value.name }}</small>
            <ng-container *ngIf="getLogoPreview()">
              <div class="logo-preview mt-3">
                <div class="logo-preview__frame">
                  <img
                    [src]="getLogoPreview()"
                    alt="Logo preview"
                    class="logo-preview__image"
                  />
                </div>
                <div class="ml-3 text-sm text-gray-600">
                  <div class="font-medium">Preview del logo</div>
                  <div class="text-xs text-gray-500">Tu marca se mostrar√° asi en la pagina web.</div>
                </div>
              </div>
            </ng-container>
            <p-message *ngIf="landingForm.get('logo')?.invalid && landingForm.get('logo')?.touched" severity="error" variant="text" size="small">El logo es requerido</p-message>
          </div>
          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="businessName">Nombre del negocio</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Escribe el nombre oficial que quieres que los clientes asocien con tu marca."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo nombre del negocio'"
              ></button>
            </div>
            <input pInputText id="businessName" formControlName="businessName" placeholder="Escribe el nombre del negocio" class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900" maxlength="50"/>
            <p-message *ngIf="landingForm.get('businessName')?.invalid && landingForm.get('businessName')?.touched" severity="error" variant="text" size="small">El nombre es requerido</p-message>
          </div>

          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="slogan">Eslogan o breve descripci√≥n</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Resume en una frase corta lo que hace especial tu negocio."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo eslogan'"
              ></button>
            </div>
            <textarea pTextarea id="slogan" formControlName="slogan" rows="2" placeholder="Escribe tu eslogan" maxlength="100"
                      class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900"></textarea>
            <p-message *ngIf="landingForm.get('slogan')?.invalid && landingForm.get('slogan')?.touched" severity="error" variant="text" size="small">El eslogan es requerido</p-message>
          </div>
        </div>

        <!-- Paso 2: Historia y Filosof√≠a -->
        <div *ngSwitchCase="2" class="flex flex-col gap-4">
          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="history">Historia</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Cuenta el origen y prop√≥sito de tu negocio en un tono cercano."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo historia'"
              ></button>
            </div>
            <textarea pTextarea id="history" formControlName="history" rows="4" maxlength="500"
                     placeholder="‚ú® Cu√©ntanos tu historia...
üìç ¬øC√≥mo naci√≥ tu negocio?
üç∞ ¬øQu√© te inspira cada d√≠a?"
                     maxlength="500" class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900"></textarea>
            <p-message *ngIf="landingForm.get('history')?.invalid && landingForm.get('history')?.touched" severity="error" variant="text" size="small">La historia es requerida</p-message>
          </div>
          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="vision">Visi√≥n</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Describe hacia d√≥nde quieres llevar la experiencia de tus clientes."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo visi√≥n'"
              ></button>
            </div>
            <textarea pTextarea id="vision" formControlName="vision" rows="4"
            placeholder="üëÄ Cu√©ntanos tu visi√≥n...
‚ú® ¬øC√≥mo quieres impactar a tus clientes, tu comunidad o el mundo?"
            maxlength="500" class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900"></textarea>
            <p-message *ngIf="landingForm.get('vision')?.invalid && landingForm.get('vision')?.touched" severity="error" variant="text" size="small">La visi√≥n es requerida</p-message>
          </div>
        </div>

        <!-- Paso 3: Informaci√≥n de Contacto -->
        <div *ngSwitchCase="3" class="flex flex-col gap-4">
          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="address">Direcci√≥n</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Indica la direcci√≥n completa para que los clientes sepan d√≥nde encontrarte."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo direcci√≥n'"
              ></button>
            </div>
            <textarea pTextarea id="address" formControlName="address" rows="2" placeholder="Direcci√≥n" class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900"></textarea>
            <p-message *ngIf="landingForm.get('address')?.invalid && landingForm.get('address')?.touched" severity="error" variant="text" size="small">La direcci√≥n es requerida</p-message>
          </div>
          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="phone">Tel√©fono</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Incluye el n√∫mero que usar√°s para atender llamadas o mensajes."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo tel√©fono'"
              ></button>
            </div>
            <input pInputText id="phone" formControlName="phone" placeholder="Tel√©fono" class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900" />
            <p-message *ngIf="landingForm.get('phone')?.invalid && landingForm.get('phone')?.touched" severity="error" variant="text" size="small">El tel√©fono es requerido</p-message>
          </div>
          <div class="flex flex-col gap-2 mb-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="email">Bussines Email</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Correo oficial donde recibir√°s solicitudes y notificaciones de tu web."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo email'"
              ></button>
            </div>
            <input pInputText id="email" formControlName="email" placeholder="Email del negocio" class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900" />
            <p-message *ngIf="landingForm.get('email')?.invalid && landingForm.get('email')?.touched" severity="error" variant="text" size="small">Email inv√°lido o requerido</p-message>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" for="schedule">Horarios <span class="text-red-500">*</span></label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                pTooltip="Cu√©ntales tus horarios de atenci√≥n para que sepan cu√°ndo visitarte."
                tooltipPosition="top"
                [attr.aria-label]="'Descripci√≥n del campo horarios'"
              ></button>
            </div>
            <textarea pTextarea id="schedule" formControlName="schedule" rows="4" maxlength="250"
            placeholder="üïê Indica tus horarios de atenci√≥n
Ejemplo:
Lunes a Viernes de 8:00 a 20:00 Hrs.
S√°bados y Domingos de 9:00 a 18:00 Hrs."
            class="rounded border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900"></textarea>
            <p-message *ngIf="landingForm.get('schedule')?.invalid && landingForm.get('schedule')?.touched" severity="error" variant="text" size="small">Los horarios son requeridos</p-message>
          </div>
        </div>

        <!-- Paso 4: Redes Sociales -->
        <div *ngSwitchCase="4" class="flex flex-col gap-4">
          <div class="flex flex-col gap-2" *ngFor="let social of socialPlatforms">
            <div class="flex items-center gap-2">
              <label class="font-semibold text-gray-800" [for]="social.control">{{social.name}}</label>
              <button
                pButton
                type="button"
                icon="pi pi-info-circle"
                class="p-button-rounded p-button-sm p-button-text text-primary-600"
                [pTooltip]="'Comparte el enlace directo a tu perfil en ' + social.name"
                tooltipPosition="top"
                [attr.aria-label]="'Ayuda para ' + social.name"
              ></button>
            </div>
            <div class="p-inputgroup">
              <span class="p-inputgroup-addon bg-gray-100 rounded-l mr-4"><i [class]="social.icon"></i></span>
              <input pInputText [id]="social.control" [formControlName]="social.control" placeholder="{{social.name}}" class="rounded-r border border-gray-300 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition text-gray-900" />
            </div>
          </div>
        </div>

        <!-- Paso 5: Vista Previa -->
        <div *ngSwitchCase="5" class="flex flex-col gap-4">
          <!-- Datos Generales -->
          <p-panel header="Datos Generales" [toggleable]="false">
            <div class="preview-section">
              <div class="preview-logo-container" *ngIf="getLogoPreview()">
                <img [src]="getLogoPreview()" alt="Logo" class="preview-logo" />
              </div>
              <div class="preview-field">
                <label class="preview-label">Nombre del Negocio</label>
                <p class="preview-value">{{landingForm.value.businessName || '‚Äî'}}</p>
              </div>
              <div class="preview-field">
                <label class="preview-label">Eslogan</label>
                <p class="preview-value">{{landingForm.value.slogan || '‚Äî'}}</p>
              </div>
            </div>
          </p-panel>

          <!-- Historia y Filosof√≠a -->
          <p-panel header="Historia y Filosof√≠a" [toggleable]="false">
            <div class="preview-section">
              <div class="preview-field">
                <label class="preview-label">Historia</label>
                <div *ngIf="landingForm.value.history; else historyPlaceholder">
                  <p class="preview-text" [innerHTML]="landingForm.value.history"></p>
                </div>
                <ng-template #historyPlaceholder>
                  <p class="preview-text text-gray-400"><em>Cu√©ntanos tu historia para mostrarla aqu√≠.</em></p>
                </ng-template>
              </div>
              <div class="preview-field">
                <label class="preview-label">Visi√≥n</label>
                <div *ngIf="landingForm.value.vision; else visionPlaceholder">
                  <p class="preview-text" [innerHTML]="landingForm.value.vision"></p>
                </div>
                <ng-template #visionPlaceholder>
                  <p class="preview-text text-gray-400"><em>Define la visi√≥n para mostrarla aqu√≠.</em></p>
                </ng-template>
              </div>
            </div>
          </p-panel>

          <!-- Informaci√≥n de Contacto -->
          <p-panel header="Informaci√≥n de Contacto" [toggleable]="false">
            <div class="preview-section">
              <div class="preview-field">
                <label class="preview-label">Direcci√≥n</label>
                <p class="preview-value">{{landingForm.value.address || '‚Äî'}}</p>
              </div>
              <div class="preview-field">
                <label class="preview-label">Tel√©fono</label>
                <p class="preview-value">{{landingForm.value.phone || '‚Äî'}}</p>
              </div>
              <div class="preview-field">
                <label class="preview-label">Email</label>
                <p class="preview-value">{{landingForm.value.email || '‚Äî'}}</p>
              </div>
              <div class="preview-field">
                <label class="preview-label">Horarios de Atenci√≥n</label>
                <p class="preview-value" style="white-space: pre-line;">{{landingForm.value.schedule || '‚Äî'}}</p>
              </div>
            </div>
          </p-panel>

          <!-- Redes Sociales -->
          <p-panel header="Redes Sociales" [toggleable]="false">
            <div class="preview-section">
              <div *ngFor="let social of socialPlatforms" class="preview-field">
                <label class="preview-label">
                  <i [class]="social.icon" class="mr-2"></i>{{social.name}}
                </label>
                <p class="preview-value" style="word-break: break-all;">{{landingForm.value[social.control] || '‚Äî'}}</p>
              </div>
            </div>
          </p-panel>


          <div class="flex flex-row gap-4 justify-end">
            <button pButton type="button" label="Volver a editar" class="p-button-secondary rounded" (click)="edit()"></button>
            <button pButton type="button" label="Guardar cambios" class="p-button-success rounded" (click)="save()"></button>
          </div>
        </div>
      </ng-container>

      <div class="flex flex-row gap-4 justify-end" *ngIf="step < 5">
        <button pButton type="button" label="Anterior" class="p-button-secondary rounded" (click)="prevStep()" [disabled]="step === 1"></button>
        <button pButton type="button" label="Siguiente" class="p-button-primary rounded" (click)="nextStep()"></button>
      </div>
      </form>
    </div>
  </div>
</div>
<app-confetti></app-confetti>

<p-dialog
  [(visible)]="showSetupPrompt"
  [modal]="true"
  [closable]="false"
  [style]="{ width: '28rem', textAlign: 'center', borderRadius: '1.25rem', overflow: 'hidden' }"
  contentStyle="padding:2rem 1.75rem; border-radius:1.25rem;"
  baseZIndex="2100"
>
  <div class="flex flex-col items-center gap-3 text-center">
    <span class="text-4xl" aria-hidden="true">üåü</span>
    <h2 class="font-bold text-2xl text-primary-700">{{ setupPromptText.title }}</h2>
    <p class="text-gray-700 line-height-3">
      {{ setupPromptText.description }}
    </p>
    <button
      pButton
      type="button"
      class="p-button-primary w-full mt-2"
      [label]="setupPromptCta"
      (click)="startConfiguration()"
    ></button>
  </div>
</p-dialog>

<p-dialog
  [(visible)]="showCongrats"
  [modal]="true"
  [closable]="false"
  [style]="{ width: '30rem', textAlign: 'center', borderRadius: '1.5rem', overflow: 'hidden' }"
  contentStyle="padding:2.5rem 2rem; border-radius:1.5rem;"
  baseZIndex="2000"
>
  <div class="flex flex-col items-center justify-center gap-4">
    <div style="font-size:2.2rem;">üéâ</div>
    <h2 class="font-bold text-2xl text-primary-700 mb-2">¬°Felicidades!</h2>
    <div class="text-lg text-gray-700 mb-2">
      Est√°s a un paso de dejar tu p√°gina lista.<br>
      ¬°Configura tu men√∫ y haz que tus clientes se enamoren de tus productos! üç∞‚òï
    </div>
    <button pButton
        label="Configura tu men√∫"
        icon="pi pi-cog"
        class="p-button-rounded p-button-success mt-3"
        (click)="goToMenuConfig()">
    </button>
  </div>
</p-dialog>
