
<p-toolbar styleClass="mb-6">
    <ng-template #start>
        <p-button label="Nueva Campaña" icon="pi pi-plus" severity="secondary" class="mr-2" styleClass="text-sm p-button-sm" (onClick)="createNewCampaign()" />
    </ng-template>
    <ng-template #end>
        <p-button icon="pi pi-refresh" severity="secondary" (onClick)="refreshData()" aria-label="Refrescar datos" />
    </ng-template>
</p-toolbar>

<p-table [value]="filteredCampaigns()" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 20]" [loading]="loading()" responsiveLayout="scroll" [globalFilterFields]="['title', 'subtitle', 'description']" [rowHover]="true" [tableStyle]="{ 'min-width': '65rem' }">
    <ng-template pTemplate="caption">
        <div class="flex items-center justify-between">
            <h5 class="m-0">Gestión de Campañas</h5>
            <p-iconfield>
                <p-inputicon styleClass="pi pi-search" />
                <input pInputText type="text" (input)="onSearchChange($event)" [(ngModel)]="searchText" placeholder="Buscar campañas..." />
            </p-iconfield>
        </div>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                {{ col.header }}
                <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
            <th>Acciones</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-campaign>
        <tr>
            <td>
                <div class="flex flex-column">
                    <span class="font-medium">{{ campaign.title }}</span>
                    <small class="text-500" *ngIf="campaign.subtitle">{{ campaign.subtitle }}</small>
                </div>
            </td>
            <td>
                <p-chip [label]="campaign.promoType || 'N/A'" styleClass="p-chip-outlined"> </p-chip>
            </td>
            <td>
                <p-chip [label]="getStatusLabel(campaign.status)" [style]="getStatusStyle(campaign.status)"> </p-chip>
            </td>
            <td>
                <div class="flex flex-column" *ngIf="campaign.startDate || campaign.endDate">
                    <small *ngIf="campaign.startDate">
                        <i class="pi pi-calendar mr-1"></i>
                        {{ campaign.startDate | date: 'dd/MM/yyyy' }}
                    </small>
                    <small *ngIf="campaign.endDate" class="text-500"> hasta {{ campaign.endDate | date: 'dd/MM/yyyy' }} </small>
                </div>
                <span *ngIf="!campaign.startDate && !campaign.endDate">-</span>
            </td>
            <td>
                <div class="flex flex-wrap gap-1" *ngIf="campaign.channels?.length">
                    <p-chip *ngFor="let channel of campaign.channels.slice(0, 2)" [label]="channel" size="small" styleClass="p-chip-outlined"> </p-chip>
                    <span *ngIf="campaign.channels.length > 2" class="text-xs text-500"> +{{ campaign.channels.length - 2 }} más </span>
                </div>
                <span *ngIf="!campaign.channels?.length">-</span>
            </td>
            <td>
                <div class="flex gap-2">
                    <p-button icon="pi pi-eye" size="small" severity="info" (onClick)="viewCampaign(campaign)" aria-label="Ver detalles de la campaña"> </p-button>
                    <p-button icon="pi pi-pencil" size="small" severity="secondary" (onClick)="editCampaign(campaign)" aria-label="Editar campaña"> </p-button>
                    <p-button icon="pi pi-trash" size="small" severity="danger" (onClick)="deleteCampaign(campaign)" aria-label="Eliminar campaña"> </p-button>
                </div>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td [attr.colspan]="columns.length + 1" class="py-8">
                <div class="flex flex-col items-center justify-center gap-2">

                    <h3 class="text-2xl font-semibold text-gray-800 mb-1 text-center">No se encontraron campañas</h3>
                    <p class="text-gray-500 mb-4 text-center" style="max-width: 350px;">
                        {{ searchText || selectedStatus ? 'No hay campañas que coincidan con los filtros.' : 'Crea tu primera campaña para comenzar.' }}
                    </p>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>

<p-confirmDialog header="Confirmar eliminación"></p-confirmDialog>

<!-- Campaign Dialog -->
<app-campaign-dialog
    #campaignDialogRef
    [(visible)]="campaignDialog"
    [campaign]="selectedCampaign()"
    [submitted]="submitted()"
    [isEditMode]="isEditMode()"
    (save)="saveCampaign(campaignDialogRef)"
    (hide)="hideCampaignDialog()">
</app-campaign-dialog>

<p-toast></p-toast>
