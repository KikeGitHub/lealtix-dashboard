<p-dialog
  [(visible)]="visible"
  [style]="{ width: '90vw', maxWidth: '900px' }"
  header="Vista Previa Completa de la Promoción"
  [modal]="true"
  [dismissableMask]="true"
  (onHide)="onClose()"
>
  <div class="preview-capture" #captureArea>
    <!-- Diseño moderno tipo imagen promocional -->
    <div class="promo-card">
      <!-- Fondo decorativo con gradientes -->
      <div class="promo-background">
        <div class="gradient-overlay"></div>
        <div class="geometric-patterns">
          <div class="pattern-circle pattern-1"></div>
          <div class="pattern-circle pattern-2"></div>
          <div class="pattern-circle pattern-3"></div>
        </div>
      </div>

      <!-- Header con branding del cliente -->
      <header class="promo-header-modern">
        <a
          [href]="getLandingUrl()"
          target="_blank"
          rel="noopener noreferrer"
          class="client-branding-link-modern"
        >
          <div class="client-branding-compact">
            <div class="client-avatar">
              <img
                *ngIf="clientLogo"
                [src]="clientLogo"
                [alt]="clientName || 'Logo del cliente'"
                class="client-logo-modern"
                decoding="async"
                crossorigin="anonymous"
              />
              <div *ngIf="!clientLogo" class="client-initials-modern">
                {{ getClientInitials() }}
              </div>
            </div>
            <div class="client-info-compact" *ngIf="clientName">
              <h4 class="client-name-modern">{{ clientName }}</h4>
              <span class="promo-badge">PROMOCIÓN ESPECIAL</span>
            </div>
          </div>
        </a>
      </header>

      <!-- Contenido principal -->
      <main class="promo-content-main">
        <!-- Sección de imagen destacada -->
        <section class="promo-visual-section" *ngIf="previewData.imageUrl">
          <div class="image-container-modern">
            <img
              [src]="getOptimizedImageUrl(previewData.imageUrl)"
              [alt]="previewData.title || 'Imagen de promoción'"
              class="promo-hero-image"
              decoding="async"
              crossorigin="anonymous"
              (error)="onImageError($event)"
            />
            <div class="image-overlay"></div>
          </div>
        </section>

        <!-- Sección de contenido de texto -->
        <section class="promo-content-section">
          <!-- Título y subtítulo -->
          <div class="title-section">
            <h1 class="promo-title-modern">
              {{ previewData.title || 'Oferta Especial' }}
            </h1>
            <p class="promo-subtitle-modern" *ngIf="previewData.subtitle">
              {{ previewData.subtitle }}
            </p>
          </div>

          <!-- Valor de la oferta destacado -->
          <div class="offer-highlight" *ngIf="previewData.promoValue">
            <div class="offer-value-modern">
              <span class="discount-text">{{ previewData.promoValue }}</span>
              <span class="offer-type-text" *ngIf="previewData.promoType">
                {{ getPromoTypeLabel(previewData.promoType) }}
              </span>
            </div>
          </div>

          <!-- Descripción -->
          <div class="description-section">
            <p class="promo-description-modern">
              {{ previewData.description || 'No te pierdas esta increíble oportunidad. Oferta por tiempo limitado.' }}
            </p>
          </div>

          <!-- Información temporal -->
          <div class="time-info" *ngIf="previewData.startDate || previewData.endDate">
            <div class="validity-modern">
              <i class="pi pi-clock time-icon"></i>
              <span class="validity-text-modern">
                <span *ngIf="previewData.startDate">Desde {{ formatDate(previewData.startDate) }}</span>
                <span *ngIf="previewData.startDate && previewData.endDate"> • </span>
                <span *ngIf="previewData.endDate">Hasta {{ formatDate(previewData.endDate) }}</span>
              </span>
            </div>
          </div>

          <!-- Call to Action -->
          <div class="cta-section" *ngIf="showButton">
            <p-button
              [label]="previewData.buttonText || 'OBTENER AHORA'"
              icon="pi pi-arrow-right"
              iconPos="right"
              styleClass="cta-button-modern"
            ></p-button>
          </div>
        </section>

        <!-- Placeholder cuando no hay imagen -->
        <section class="no-image-section" *ngIf="!previewData.imageUrl">
          <div class="no-image-placeholder-modern">
            <div class="placeholder-icon">
              <i class="pi pi-image"></i>
            </div>
            <p class="placeholder-text">Vista previa de tu promoción</p>
          </div>
        </section>
      </main>

      <!-- Footer con branding Lealtix -->
      <footer class="promo-footer-modern">
        <div class="footer-content">
          <span class="powered-text">Creado con</span>
          <a [href]="lealtixUrl" target="_blank" rel="noopener noreferrer" class="lealtix-brand">
            <strong>Lealtix</strong>
          </a>
        </div>
      </footer>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex gap-2 justify-content-end">
      <p-button
        label="Cerrar"
        icon="pi pi-times"
        severity="secondary"
        (onClick)="onClose()"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>
