<div class="reward-form-container">
  <form [formGroup]="rewardForm" (ngSubmit)="onSubmit()">
    <div class="form-section">
      <!-- Tipo de Reward -->
      <div class="field">
        <label for="rewardType" class="font-semibold">
          Tipo de beneficio <span class="text-red-500">*</span>
          <i class="pi pi-info-circle ml-2 text-500"
             pTooltip="Selecciona el tipo de beneficio que recibir치n tus clientes. Cada tipo tiene configuraciones espec칤ficas."
             tooltipPosition="right"></i>
        </label>
        <p-select #rewardTypeSelect
          id="rewardType"
          formControlName="rewardType"
          [options]="rewardTypes"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccione el tipo de beneficio"
          class="w-full"
          [styleClass]="rewardForm.get('rewardType')?.invalid && rewardForm.get('rewardType')?.touched ? 'ng-invalid ng-dirty' : ''"
        ></p-select>

        <!-- Mensaje de error inline -->
        <p-message
          *ngIf="rewardForm.get('rewardType')?.invalid && rewardForm.get('rewardType')?.touched"
          severity="warn"
          text="Debes seleccionar un tipo de beneficio para continuar"
          styleClass="mt-2 w-full">
        </p-message>

        <!-- Mensaje de ayuda informativo -->
        <small class="text-500 block mt-2" *ngIf="!rewardForm.get('rewardType')?.value">
          游눠 Elige c칩mo quieres recompensar a tus clientes
        </small>
      </div>

      <!-- Valor Num칠rico (para PERCENT_DISCOUNT y FIXED_AMOUNT) -->
      <div class="field" *ngIf="showNumericValue">
        <label for="numericValue" class="font-semibold">
          {{ numericValueLabel }} <span class="text-red-500">*</span>
          <i class="pi pi-info-circle ml-2 text-500"
             [pTooltip]="selectedRewardType === 'PERCENT_DISCOUNT' ? 'Ingresa el porcentaje de descuento (1-100%)' : 'Ingresa el monto fijo en pesos que se descontar치'"
             tooltipPosition="right"></i>
        </label>
        <p-inputnumber
          id="numericValue"
          formControlName="numericValue"
          class="w-full"
          [min]="0"
          [max]="selectedRewardType === 'PERCENT_DISCOUNT' ? 100 : 999999"
          [suffix]="selectedRewardType === 'PERCENT_DISCOUNT' ? '%' : ''"
          [prefix]="selectedRewardType === 'FIXED_AMOUNT' ? '$' : ''"
          [styleClass]="rewardForm.get('numericValue')?.invalid && rewardForm.get('numericValue')?.touched ? 'ng-invalid ng-dirty' : ''"
        ></p-inputnumber>
        <small class="p-error" *ngIf="rewardForm.get('numericValue')?.invalid && rewardForm.get('numericValue')?.touched">
          Este campo es requerido
        </small>
        <small class="text-500 block mt-1" *ngIf="!rewardForm.get('numericValue')?.invalid && selectedRewardType === 'PERCENT_DISCOUNT'">
          Ejemplo: 20 para un 20% de descuento
        </small>
        <small class="text-500 block mt-1" *ngIf="!rewardForm.get('numericValue')?.invalid && selectedRewardType === 'FIXED_AMOUNT'">
          Ejemplo: 50 para $50 de descuento
        </small>
      </div>

      <!-- ID de Producto (para FREE_PRODUCT) -->
      <div class="field" *ngIf="showProductId">
        <label for="productId" class="font-semibold">
          ID del producto <span class="text-red-500">*</span>
          <i class="pi pi-info-circle ml-2 text-500"
             pTooltip="Ingresa el ID del producto que se regalar치. Puedes encontrar el ID en tu cat치logo de productos."
             tooltipPosition="right"></i>
        </label>
        <p-inputnumber
          id="productId"
          formControlName="productId"
          class="w-full"
          [min]="1"
          [useGrouping]="false"
          [styleClass]="rewardForm.get('productId')?.invalid && rewardForm.get('productId')?.touched ? 'ng-invalid ng-dirty' : ''"
        ></p-inputnumber>
        <small class="p-error" *ngIf="rewardForm.get('productId')?.invalid && rewardForm.get('productId')?.touched">
          Este campo es requerido
        </small>
        <small class="text-500 block mt-1" *ngIf="!rewardForm.get('productId')?.invalid">
          Ve a la secci칩n de Productos para encontrar el ID
        </small>
      </div>

      <!-- Cantidades para BUY_X_GET_Y -->
      <div class="field" *ngIf="showBuyGetQuantities">
        <label for="buyQuantity" class="font-semibold">
          Cantidad a comprar <span class="text-red-500">*</span>
          <i class="pi pi-info-circle ml-2 text-500"
             pTooltip="N칰mero de productos que el cliente debe comprar para recibir el beneficio"
             tooltipPosition="right"></i>
        </label>
        <p-inputnumber
          id="buyQuantity"
          formControlName="buyQuantity"
          class="w-full"
          [min]="1"
          [useGrouping]="false"
          [styleClass]="rewardForm.get('buyQuantity')?.invalid && rewardForm.get('buyQuantity')?.touched ? 'ng-invalid ng-dirty' : ''"
        ></p-inputnumber>
        <small class="p-error" *ngIf="rewardForm.get('buyQuantity')?.invalid && rewardForm.get('buyQuantity')?.touched">
          Este campo es requerido
        </small>
        <small class="text-500 block mt-1" *ngIf="!rewardForm.get('buyQuantity')?.invalid">
          Ejemplo: 2 para "Compra 2"
        </small>
      </div>

      <div class="field" *ngIf="showBuyGetQuantities">
        <label for="freeQuantity" class="font-semibold">
          Cantidad gratis <span class="text-red-500">*</span>
          <i class="pi pi-info-circle ml-2 text-500"
             pTooltip="N칰mero de productos que el cliente recibir치 gratis al completar la compra"
             tooltipPosition="right"></i>
        </label>
        <p-inputnumber
          id="freeQuantity"
          formControlName="freeQuantity"
          class="w-full"
          [min]="1"
          [useGrouping]="false"
          [styleClass]="rewardForm.get('freeQuantity')?.invalid && rewardForm.get('freeQuantity')?.touched ? 'ng-invalid ng-dirty' : ''"
        ></p-inputnumber>
        <small class="p-error" *ngIf="rewardForm.get('freeQuantity')?.invalid && rewardForm.get('freeQuantity')?.touched">
          Este campo es requerido
        </small>
        <small class="text-500 block mt-1" *ngIf="!rewardForm.get('freeQuantity')?.invalid">
          Ejemplo: 1 para "Lleva 1 gratis"
        </small>
      </div>

      <!-- Descripci칩n (para CUSTOM y opcional para otros) -->
      <div class="field" *ngIf="showDescription || selectedRewardType">
        <label for="description" class="font-semibold">
          Descripci칩n {{ showDescription ? '' : '(opcional)' }}
          <span class="text-red-500" *ngIf="showDescription">*</span>
          <i class="pi pi-info-circle ml-2 text-500"
             [pTooltip]="showDescription ? 'Describe detalladamente el beneficio personalizado' : 'Agrega informaci칩n adicional sobre el beneficio (opcional)'"
             tooltipPosition="right"></i>
        </label>
        <textarea
          pTextarea
          id="description"
          formControlName="description"
          rows="3"
          class="w-full"
          placeholder="Descripci칩n del beneficio"
          [class.ng-invalid]="rewardForm.get('description')?.invalid && rewardForm.get('description')?.touched"
          [class.ng-dirty]="rewardForm.get('description')?.invalid && rewardForm.get('description')?.touched"
        ></textarea>
        <small class="p-error" *ngIf="rewardForm.get('description')?.invalid && rewardForm.get('description')?.touched">
          Este campo es requerido
        </small>
        <small class="text-500 block mt-1" *ngIf="!rewardForm.get('description')?.invalid && showDescription">
          Explica claramente qu칠 recibir치 el cliente
        </small>
      </div>

      <!-- Campos opcionales -->
      <div class="field" *ngIf="selectedRewardType">
        <label for="minPurchaseAmount" class="font-semibold">
          Monto m칤nimo de compra (opcional)
          <i class="pi pi-info-circle ml-2 text-500"
             pTooltip="Define un monto m칤nimo de compra para que el beneficio sea v치lido"
             tooltipPosition="right"></i>
        </label>
        <p-inputnumber
          id="minPurchaseAmount"
          formControlName="minPurchaseAmount"
          class="w-full"
          [min]="0"
          prefix="$"
          placeholder="0.00"
        ></p-inputnumber>
        <small class="text-500 block mt-1">
          Ejemplo: $500 m칤nimo de compra para usar el beneficio
        </small>
      </div>

      <div class="field" *ngIf="selectedRewardType">
        <label for="usageLimit" class="font-semibold">
          L칤mite de uso (opcional)
          <i class="pi pi-info-circle ml-2 text-500"
             pTooltip="N칰mero m치ximo de veces que este beneficio puede ser usado en total"
             tooltipPosition="right"></i>
        </label>
        <p-inputnumber
          id="usageLimit"
          formControlName="usageLimit"
          class="w-full"
          [min]="1"
          [useGrouping]="false"
          placeholder="Sin l칤mite"
        ></p-inputnumber>
        <small class="text-500 block mt-1">
          Ejemplo: 100 para limitar a 100 usos totales
        </small>
      </div>

      <!-- Botones de acci칩n removidos - el guardado se maneja desde el bot칩n principal de la campa침a -->
    </div>
  </form>
</div>
